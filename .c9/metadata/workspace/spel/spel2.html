{"filter":false,"title":"spel2.html","tooltip":"/spel/spel2.html","undoManager":{"mark":90,"position":90,"stack":[[{"start":{"row":0,"column":0},"end":{"row":13,"column":7},"action":"insert","lines":["<!DOCTYPE html>","<html>","<head>","    <title>HTML5 Puzzle</title>","    <script>"," ","    </script>","</head>"," ","<body onload=\"init();\">","    <canvas id=\"canvas\"></canvas>","</body>"," ","</html>"],"id":1}],[{"start":{"row":3,"column":3},"end":{"row":3,"column":4},"action":"remove","lines":[" "],"id":2}],[{"start":{"row":3,"column":2},"end":{"row":3,"column":3},"action":"remove","lines":[" "],"id":3}],[{"start":{"row":3,"column":1},"end":{"row":3,"column":2},"action":"remove","lines":[" "],"id":4}],[{"start":{"row":3,"column":0},"end":{"row":3,"column":1},"action":"remove","lines":[" "],"id":5}],[{"start":{"row":3,"column":0},"end":{"row":3,"column":4},"action":"insert","lines":["    "],"id":6}],[{"start":{"row":1,"column":5},"end":{"row":1,"column":6},"action":"insert","lines":[" "],"id":7}],[{"start":{"row":1,"column":6},"end":{"row":1,"column":7},"action":"insert","lines":["l"],"id":8}],[{"start":{"row":1,"column":7},"end":{"row":1,"column":8},"action":"insert","lines":["a"],"id":9}],[{"start":{"row":1,"column":8},"end":{"row":1,"column":9},"action":"insert","lines":["n"],"id":10}],[{"start":{"row":1,"column":9},"end":{"row":1,"column":10},"action":"insert","lines":["g"],"id":11}],[{"start":{"row":1,"column":10},"end":{"row":1,"column":11},"action":"insert","lines":["="],"id":12}],[{"start":{"row":1,"column":11},"end":{"row":1,"column":13},"action":"insert","lines":["\"\""],"id":13}],[{"start":{"row":1,"column":12},"end":{"row":1,"column":13},"action":"insert","lines":["n"],"id":14}],[{"start":{"row":1,"column":13},"end":{"row":1,"column":14},"action":"insert","lines":["l"],"id":15}],[{"start":{"row":4,"column":3},"end":{"row":4,"column":4},"action":"remove","lines":[" "],"id":16}],[{"start":{"row":4,"column":2},"end":{"row":4,"column":3},"action":"remove","lines":[" "],"id":17}],[{"start":{"row":4,"column":1},"end":{"row":4,"column":2},"action":"remove","lines":[" "],"id":18}],[{"start":{"row":4,"column":0},"end":{"row":4,"column":1},"action":"remove","lines":[" "],"id":19}],[{"start":{"row":4,"column":0},"end":{"row":4,"column":4},"action":"insert","lines":["    "],"id":20}],[{"start":{"row":6,"column":3},"end":{"row":6,"column":4},"action":"remove","lines":[" "],"id":21}],[{"start":{"row":6,"column":2},"end":{"row":6,"column":3},"action":"remove","lines":[" "],"id":22}],[{"start":{"row":6,"column":1},"end":{"row":6,"column":2},"action":"remove","lines":[" "],"id":23}],[{"start":{"row":6,"column":0},"end":{"row":6,"column":1},"action":"remove","lines":[" "],"id":24}],[{"start":{"row":5,"column":0},"end":{"row":5,"column":1},"action":"remove","lines":[" "],"id":25}],[{"start":{"row":6,"column":0},"end":{"row":6,"column":4},"action":"insert","lines":["    "],"id":26}],[{"start":{"row":6,"column":12},"end":{"row":6,"column":13},"action":"remove","lines":[">"],"id":27}],[{"start":{"row":6,"column":11},"end":{"row":6,"column":12},"action":"remove","lines":["t"],"id":28}],[{"start":{"row":6,"column":10},"end":{"row":6,"column":11},"action":"remove","lines":["p"],"id":29}],[{"start":{"row":6,"column":9},"end":{"row":6,"column":10},"action":"remove","lines":["i"],"id":30}],[{"start":{"row":6,"column":8},"end":{"row":6,"column":9},"action":"remove","lines":["r"],"id":31}],[{"start":{"row":6,"column":7},"end":{"row":6,"column":8},"action":"remove","lines":["c"],"id":32}],[{"start":{"row":6,"column":6},"end":{"row":6,"column":7},"action":"remove","lines":["s"],"id":33}],[{"start":{"row":6,"column":5},"end":{"row":6,"column":6},"action":"remove","lines":["/"],"id":34}],[{"start":{"row":6,"column":4},"end":{"row":6,"column":5},"action":"remove","lines":["<"],"id":35}],[{"start":{"row":6,"column":0},"end":{"row":6,"column":4},"action":"remove","lines":["    "],"id":36}],[{"start":{"row":5,"column":0},"end":{"row":6,"column":0},"action":"remove","lines":["",""],"id":37}],[{"start":{"row":4,"column":12},"end":{"row":5,"column":0},"action":"remove","lines":["",""],"id":38}],[{"start":{"row":4,"column":11},"end":{"row":4,"column":12},"action":"remove","lines":[">"],"id":39}],[{"start":{"row":4,"column":10},"end":{"row":4,"column":11},"action":"remove","lines":["t"],"id":40}],[{"start":{"row":4,"column":9},"end":{"row":4,"column":10},"action":"remove","lines":["p"],"id":41}],[{"start":{"row":4,"column":8},"end":{"row":4,"column":9},"action":"remove","lines":["i"],"id":42}],[{"start":{"row":4,"column":7},"end":{"row":4,"column":8},"action":"remove","lines":["r"],"id":43}],[{"start":{"row":4,"column":6},"end":{"row":4,"column":7},"action":"remove","lines":["c"],"id":44}],[{"start":{"row":4,"column":5},"end":{"row":4,"column":6},"action":"remove","lines":["s"],"id":45}],[{"start":{"row":4,"column":4},"end":{"row":4,"column":5},"action":"remove","lines":["<"],"id":46}],[{"start":{"row":4,"column":0},"end":{"row":4,"column":4},"action":"remove","lines":["    "],"id":47}],[{"start":{"row":3,"column":31},"end":{"row":4,"column":0},"action":"remove","lines":["",""],"id":48}],[{"start":{"row":9,"column":0},"end":{"row":9,"column":1},"action":"remove","lines":[" "],"id":49}],[{"start":{"row":7,"column":0},"end":{"row":7,"column":1},"action":"remove","lines":[" "],"id":50}],[{"start":{"row":7,"column":0},"end":{"row":7,"column":1},"action":"remove","lines":[" "],"id":51}],[{"start":{"row":7,"column":0},"end":{"row":7,"column":1},"action":"remove","lines":[" "],"id":52}],[{"start":{"row":7,"column":0},"end":{"row":7,"column":1},"action":"remove","lines":[" "],"id":53}],[{"start":{"row":7,"column":0},"end":{"row":7,"column":4},"action":"insert","lines":["    "],"id":54}],[{"start":{"row":8,"column":0},"end":{"row":9,"column":0},"action":"insert","lines":["",""],"id":55}],[{"start":{"row":8,"column":0},"end":{"row":8,"column":4},"action":"insert","lines":["    "],"id":56}],[{"start":{"row":8,"column":4},"end":{"row":8,"column":5},"action":"insert","lines":["<"],"id":57}],[{"start":{"row":8,"column":5},"end":{"row":8,"column":6},"action":"insert","lines":["s"],"id":58}],[{"start":{"row":8,"column":6},"end":{"row":8,"column":7},"action":"insert","lines":["c"],"id":59}],[{"start":{"row":8,"column":7},"end":{"row":8,"column":8},"action":"insert","lines":["r"],"id":60}],[{"start":{"row":8,"column":8},"end":{"row":8,"column":9},"action":"insert","lines":["p"],"id":61}],[{"start":{"row":8,"column":8},"end":{"row":8,"column":9},"action":"remove","lines":["p"],"id":62}],[{"start":{"row":8,"column":8},"end":{"row":8,"column":9},"action":"insert","lines":["r"],"id":63}],[{"start":{"row":8,"column":8},"end":{"row":8,"column":9},"action":"remove","lines":["r"],"id":64}],[{"start":{"row":8,"column":8},"end":{"row":8,"column":9},"action":"insert","lines":["i"],"id":65}],[{"start":{"row":8,"column":5},"end":{"row":8,"column":9},"action":"remove","lines":["scri"],"id":66},{"start":{"row":8,"column":5},"end":{"row":8,"column":11},"action":"insert","lines":["script"]}],[{"start":{"row":8,"column":5},"end":{"row":8,"column":11},"action":"remove","lines":["script"],"id":67},{"start":{"row":8,"column":5},"end":{"row":8,"column":51},"action":"insert","lines":["script type=\"text/javascript\" src=\"\"></script>"]}],[{"start":{"row":8,"column":40},"end":{"row":8,"column":41},"action":"insert","lines":["s"],"id":68}],[{"start":{"row":8,"column":41},"end":{"row":8,"column":42},"action":"insert","lines":["p"],"id":69}],[{"start":{"row":8,"column":42},"end":{"row":8,"column":43},"action":"insert","lines":["e"],"id":70}],[{"start":{"row":8,"column":43},"end":{"row":8,"column":44},"action":"insert","lines":["l"],"id":71}],[{"start":{"row":8,"column":44},"end":{"row":8,"column":45},"action":"insert","lines":["2"],"id":72}],[{"start":{"row":8,"column":45},"end":{"row":8,"column":46},"action":"insert","lines":["j"],"id":73}],[{"start":{"row":8,"column":45},"end":{"row":8,"column":46},"action":"remove","lines":["j"],"id":74}],[{"start":{"row":8,"column":45},"end":{"row":8,"column":46},"action":"insert","lines":["."],"id":75}],[{"start":{"row":8,"column":46},"end":{"row":8,"column":47},"action":"insert","lines":["l"],"id":76}],[{"start":{"row":8,"column":47},"end":{"row":8,"column":48},"action":"insert","lines":["s"],"id":77}],[{"start":{"row":8,"column":47},"end":{"row":8,"column":48},"action":"remove","lines":["s"],"id":78}],[{"start":{"row":8,"column":46},"end":{"row":8,"column":47},"action":"remove","lines":["l"],"id":79}],[{"start":{"row":8,"column":46},"end":{"row":8,"column":47},"action":"insert","lines":["j"],"id":80}],[{"start":{"row":8,"column":47},"end":{"row":8,"column":48},"action":"insert","lines":["s"],"id":81}],[{"start":{"row":8,"column":40},"end":{"row":8,"column":41},"action":"insert","lines":["s"],"id":82}],[{"start":{"row":8,"column":41},"end":{"row":8,"column":42},"action":"insert","lines":["p"],"id":83}],[{"start":{"row":8,"column":42},"end":{"row":8,"column":43},"action":"insert","lines":["e"],"id":84}],[{"start":{"row":8,"column":43},"end":{"row":8,"column":44},"action":"insert","lines":["l"],"id":85}],[{"start":{"row":8,"column":44},"end":{"row":8,"column":45},"action":"insert","lines":["/"],"id":86}],[{"start":{"row":5,"column":0},"end":{"row":5,"column":1},"action":"remove","lines":[" "],"id":87}],[{"start":{"row":4,"column":7},"end":{"row":5,"column":0},"action":"remove","lines":["",""],"id":88}],[{"start":{"row":8,"column":7},"end":{"row":9,"column":0},"action":"remove","lines":["",""],"id":89}],[{"start":{"row":7,"column":4},"end":{"row":7,"column":64},"action":"remove","lines":["<script type=\"text/javascript\" src=\"spel/spel2.js\"></script>"],"id":91}],[{"start":{"row":7,"column":4},"end":{"row":219,"column":13},"action":"insert","lines":["    <script>","","        const PUZZLE_DIFFICULTY = 4;","        const PUZZLE_HOVER_TINT = '#009900';","","        var _stage;","        var _canvas;","","        var _img;","        var _pieces;","        var _puzzleWidth;","        var _puzzleHeight;","        var _pieceWidth;","        var _pieceHeight;","        var _currentPiece;","        var _currentDropPiece;  ","","        var _mouse;","","        function init(){","            _img = new Image();","            _img.addEventListener('load',onImage,false);","            _img.src = \"mke.jpg\";","        }","        function onImage(e){","            _pieceWidth = Math.floor(_img.width / PUZZLE_DIFFICULTY)","            _pieceHeight = Math.floor(_img.height / PUZZLE_DIFFICULTY)","            _puzzleWidth = _pieceWidth * PUZZLE_DIFFICULTY;","            _puzzleHeight = _pieceHeight * PUZZLE_DIFFICULTY;","            setCanvas();","            initPuzzle();","        }","        function setCanvas(){","            _canvas = document.getElementById('canvas');","            _stage = _canvas.getContext('2d');","            _canvas.width = _puzzleWidth;","            _canvas.height = _puzzleHeight;","            _canvas.style.border = \"1px solid black\";","        }","        function initPuzzle(){","            _pieces = [];","            _mouse = {x:0,y:0};","            _currentPiece = null;","            _currentDropPiece = null;","            _stage.drawImage(_img, 0, 0, _puzzleWidth, _puzzleHeight, 0, 0, _puzzleWidth, _puzzleHeight);","            createTitle(\"Click to Start Puzzle\");","            buildPieces();","        }","        function createTitle(msg){","            _stage.fillStyle = \"#000000\";","            _stage.globalAlpha = .4;","            _stage.fillRect(100,_puzzleHeight - 40,_puzzleWidth - 200,40);","            _stage.fillStyle = \"#FFFFFF\";","            _stage.globalAlpha = 1;","            _stage.textAlign = \"center\";","            _stage.textBaseline = \"middle\";","            _stage.font = \"20px Arial\";","            _stage.fillText(msg,_puzzleWidth / 2,_puzzleHeight - 20);","        }","        function buildPieces(){","            var i;","            var piece;","            var xPos = 0;","            var yPos = 0;","            for(i = 0;i < PUZZLE_DIFFICULTY * PUZZLE_DIFFICULTY;i++){","                piece = {};","                piece.sx = xPos;","                piece.sy = yPos;","                _pieces.push(piece);","                xPos += _pieceWidth;","                if(xPos >= _puzzleWidth){","                    xPos = 0;","                    yPos += _pieceHeight;","                }","            }","            document.onmousedown = shufflePuzzle;","        }","        function shufflePuzzle(){","            _pieces = shuffleArray(_pieces);","            _stage.clearRect(0,0,_puzzleWidth,_puzzleHeight);","            var i;","            var piece;","            var xPos = 0;","            var yPos = 0;","            for(i = 0;i < _pieces.length;i++){","                piece = _pieces[i];","                piece.xPos = xPos;","                piece.yPos = yPos;","                _stage.drawImage(_img, piece.sx, piece.sy, _pieceWidth, _pieceHeight, xPos, yPos, _pieceWidth, _pieceHeight);","                _stage.strokeRect(xPos, yPos, _pieceWidth,_pieceHeight);","                xPos += _pieceWidth;","                if(xPos >= _puzzleWidth){","                    xPos = 0;","                    yPos += _pieceHeight;","                }","            }","            document.onmousedown = onPuzzleClick;","        }","        function onPuzzleClick(e){","            if(e.layerX || e.layerX == 0){","                _mouse.x = e.layerX - _canvas.offsetLeft;","                _mouse.y = e.layerY - _canvas.offsetTop;","            }","            else if(e.offsetX || e.offsetX == 0){","                _mouse.x = e.offsetX - _canvas.offsetLeft;","                _mouse.y = e.offsetY - _canvas.offsetTop;","            }","            _currentPiece = checkPieceClicked();","            if(_currentPiece != null){","                _stage.clearRect(_currentPiece.xPos,_currentPiece.yPos,_pieceWidth,_pieceHeight);","                _stage.save();","                _stage.globalAlpha = .9;","                _stage.drawImage(_img, _currentPiece.sx, _currentPiece.sy, _pieceWidth, _pieceHeight, _mouse.x - (_pieceWidth / 2), _mouse.y - (_pieceHeight / 2), _pieceWidth, _pieceHeight);","                _stage.restore();","                document.onmousemove = updatePuzzle;","                document.onmouseup = pieceDropped;","            }","        }","        function checkPieceClicked(){","            var i;","            var piece;","            for(i = 0;i < _pieces.length;i++){","                piece = _pieces[i];","                if(_mouse.x < piece.xPos || _mouse.x > (piece.xPos + _pieceWidth) || _mouse.y < piece.yPos || _mouse.y > (piece.yPos + _pieceHeight)){","                    //PIECE NOT HIT","                }","                else{","                    return piece;","                }","            }","            return null;","        }","        function updatePuzzle(e){","            _currentDropPiece = null;","            if(e.layerX || e.layerX == 0){","                _mouse.x = e.layerX - _canvas.offsetLeft;","                _mouse.y = e.layerY - _canvas.offsetTop;","            }","            else if(e.offsetX || e.offsetX == 0){","                _mouse.x = e.offsetX - _canvas.offsetLeft;","                _mouse.y = e.offsetY - _canvas.offsetTop;","            }","            _stage.clearRect(0,0,_puzzleWidth,_puzzleHeight);","            var i;","            var piece;","            for(i = 0;i < _pieces.length;i++){","                piece = _pieces[i];","                if(piece == _currentPiece){","                    continue;","                }","                _stage.drawImage(_img, piece.sx, piece.sy, _pieceWidth, _pieceHeight, piece.xPos, piece.yPos, _pieceWidth, _pieceHeight);","                _stage.strokeRect(piece.xPos, piece.yPos, _pieceWidth,_pieceHeight);","                if(_currentDropPiece == null){","                    if(_mouse.x < piece.xPos || _mouse.x > (piece.xPos + _pieceWidth) || _mouse.y < piece.yPos || _mouse.y > (piece.yPos + _pieceHeight)){","                        //NOT OVER","                    }","                    else{","                        _currentDropPiece = piece;","                        _stage.save();","                        _stage.globalAlpha = .4;","                        _stage.fillStyle = PUZZLE_HOVER_TINT;","                        _stage.fillRect(_currentDropPiece.xPos,_currentDropPiece.yPos,_pieceWidth, _pieceHeight);","                        _stage.restore();","                    }","                }","            }","            _stage.save();","            _stage.globalAlpha = .6;","            _stage.drawImage(_img, _currentPiece.sx, _currentPiece.sy, _pieceWidth, _pieceHeight, _mouse.x - (_pieceWidth / 2), _mouse.y - (_pieceHeight / 2), _pieceWidth, _pieceHeight);","            _stage.restore();","            _stage.strokeRect( _mouse.x - (_pieceWidth / 2), _mouse.y - (_pieceHeight / 2), _pieceWidth,_pieceHeight);","        }","        function pieceDropped(e){","            document.onmousemove = null;","            document.onmouseup = null;","            if(_currentDropPiece != null){","                var tmp = {xPos:_currentPiece.xPos,yPos:_currentPiece.yPos};","                _currentPiece.xPos = _currentDropPiece.xPos;","                _currentPiece.yPos = _currentDropPiece.yPos;","                _currentDropPiece.xPos = tmp.xPos;","                _currentDropPiece.yPos = tmp.yPos;","            }","            resetPuzzleAndCheckWin();","        }","        function resetPuzzleAndCheckWin(){","            _stage.clearRect(0,0,_puzzleWidth,_puzzleHeight);","            var gameWin = true;","            var i;","            var piece;","            for(i = 0;i < _pieces.length;i++){","                piece = _pieces[i];","                _stage.drawImage(_img, piece.sx, piece.sy, _pieceWidth, _pieceHeight, piece.xPos, piece.yPos, _pieceWidth, _pieceHeight);","                _stage.strokeRect(piece.xPos, piece.yPos, _pieceWidth,_pieceHeight);","                if(piece.xPos != piece.sx || piece.yPos != piece.sy){","                    gameWin = false;","                }","            }","            if(gameWin){","                setTimeout(gameOver,500);","            }","        }","        function gameOver(){","            document.onmousedown = null;","            document.onmousemove = null;","            document.onmouseup = null;","            initPuzzle();","        }","        function shuffleArray(o){","            for(var j, x, i = o.length; i; j = parseInt(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x);","            return o;","        }","","    </script>"],"id":92}]]},"ace":{"folds":[],"scrolltop":2535.998992919922,"scrollleft":0,"selection":{"start":{"row":219,"column":13},"end":{"row":219,"column":13},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":179,"state":"js-start","mode":"ace/mode/html"}},"timestamp":1496743338583,"hash":"4a4c00dbaca481bf9a859d5b7359cef4c223b521"}